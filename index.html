<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Racing Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #gameCanvas {
      display: block;
      margin: auto;
      border: 4px solid #888;
      background: black;
    }
    #menu {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      text-align: center;
      animation: fadeIn 1.5s ease-in-out;
      background: url("giphy (35).gif") no-repeat center center;
      background-size: cover; /* gif nền menu */
    }
    h1 {
      font-size: 48px;
      color: #ffcc00;
      text-shadow: 2px 2px 10px #ff9900;
      animation: glow 2s infinite alternate;
      position: relative;
      margin-top: 100px;
    }
    p {
      font-size: 22px;
    }
    input {
      padding: 15px;
      margin-top: 15px;
      font-size: 20px;
      width: 250px;
      border-radius: 10px;
      border: 2px solid #ffcc00;
      text-align: center;
    }
    button {
      padding: 15px 30px;
      margin-top: 15px;
      cursor: pointer;
      font-size: 22px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      background: linear-gradient(45deg, #ff6600, #ffcc00);
      color: #222;
      transition: transform 0.2s, box-shadow 0.3s;
    }
    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px #ffcc00;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes glow {
      from { text-shadow: 2px 2px 10px #ff6600; }
      to { text-shadow: 2px 2px 20px #ffff66; }
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Racing Game</h1>
    <p>Enter your username:</p>
    <input type="text" id="username" placeholder="Username">
    <br>
    <button onclick="startGame()">Start Game</button>
    <p id="highscoreText"></p>
  </div>

  <canvas id="gameCanvas" width="500" height="750"></canvas>
  
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // nền cuộn
    const bgImg = new Image();
    bgImg.src = "820067622405763c6476c4934e30b716.png"; // ảnh đường chạy (png tĩnh)
    let bgY = 0;

    const carWidth = 110;
    const carHeight = 170;

    let username = "";
    let highscore = localStorage.getItem("racingHighscore") || 0;

    let player = { x: 0, y: 600, width: carWidth, height: carHeight };

    let obstacles = [];
    let coins = [];
    let speed = 2;
    let score = 0;
    let gameOver = false;

    const laneWidth = canvas.width / 3;
    const lanes = [ laneWidth / 2, laneWidth * 1.5, laneWidth * 2.5 ];

    let lastObstacleTime = 0;
    const obstacleInterval = 1500;
    let lastCoinTime = 0;
    const coinSpawnInterval = 2000;

    const coinImg = new Image();
    coinImg.src = "83c8414c-ef66-4ec3-8fcb-621cb5ab71b7.png";

    const carImg = new Image();
    carImg.src = "123123456.png";

    const coinSound = new Audio("https://www.soundjay.com/button/sounds/button-16.mp3");
    const crashSound = new Audio("https://www.soundjay.com/button/sounds/button-10.mp3");

    function startGame() {
      username = document.getElementById("username").value.trim();
      if (!username) {
        alert("Please enter a username!");
        return;
      }
      document.getElementById("menu").style.display = "none";
      resetGame();
      gameLoop();
    }

    function resetGame() {
      obstacles = [];
      coins = [];
      speed = 2;
      score = 0;
      gameOver = false;
      lastObstacleTime = 0;
      lastCoinTime = 0;
      player.x = lanes[1] - carWidth/2;
      player.y = 600;
      bgY = 0;
    }

    function drawBackground() {
      bgY += speed * 0.5; // tốc độ nền cuộn
      if (bgY >= canvas.height) bgY = 0;

      ctx.drawImage(bgImg, 0, bgY, canvas.width, canvas.height);
      ctx.drawImage(bgImg, 0, bgY - canvas.height, canvas.width, canvas.height);
    }

    function drawCar() {
      ctx.drawImage(carImg, player.x, player.y, player.width, player.height);
    }

    function drawLanes() {
      ctx.strokeStyle = "white";
      ctx.setLineDash([25, 25]);
      ctx.lineWidth = 3;
      for (let i = 1; i < 3; i++) {
        ctx.beginPath();
        ctx.moveTo(i * laneWidth, 0);
        ctx.lineTo(i * laneWidth, canvas.height);
        ctx.stroke();
      }
      ctx.setLineDash([]);
    }

    function drawObstacles() {
      ctx.fillStyle = "orange";
      obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.width, o.height));
    }

    function drawCoins() {
      coins.forEach(c => ctx.drawImage(coinImg, c.x, c.y, c.size, c.size));
    }

    function updateObstacles() {
      let now = Date.now();
      if (now - lastObstacleTime > obstacleInterval && obstacles.length < 6) {
        let numObstacles = Math.floor(Math.random() * 2) + 1;
        let availableLanes = [0, 1, 2];
        let chosenLanes = [];

        for (let i = 0; i < numObstacles; i++) {
          if (availableLanes.length === 0) break;
          let laneIndex = Math.floor(Math.random() * availableLanes.length);
          let lane = availableLanes.splice(laneIndex, 1)[0];
          chosenLanes.push(lane);
        }

        chosenLanes.forEach(lane => {
          let obsWidth = 80;
          let obsHeight = 55;
          obstacles.push({ 
            x: lanes[lane] - obsWidth/2, 
            y: -120, 
            width: obsWidth, 
            height: obsHeight 
          });
        });
        lastObstacleTime = now;
      }

      obstacles.forEach(o => o.y += speed);
      obstacles = obstacles.filter(o => o.y < canvas.height);
    }

    function updateCoins() {
      let now = Date.now();
      if (now - lastCoinTime > coinSpawnInterval) {
        let lane = Math.floor(Math.random() * 3);
        coins.push({ x: lanes[lane] - 25, y: -60, size: 50 });
        lastCoinTime = now;
      }
      coins.forEach(c => c.y += speed);
      coins = coins.filter(c => c.y < canvas.height);
    }

    function checkCollisions() {
      obstacles.forEach(o => {
        if (
          player.x < o.x + o.width &&
          player.x + player.width > o.x &&
          player.y < o.y + o.height &&
          player.height + player.y > o.y
        ) {
          crashSound.play();
          gameOver = true;
        }
      });

      coins.forEach((c, index) => {
        if (
          player.x < c.x + c.size &&
          player.x + player.width > c.x &&
          player.y < c.y + c.size &&
          player.height + player.y > c.y
        ) {
          coinSound.play();
          score += 10;
          coins.splice(index, 1);
        }
      });
    }

    function drawScore() {
      ctx.fillStyle = "white";
      ctx.font = "26px Arial";
      ctx.fillText("Score: " + score, 15, 40);
      ctx.fillText("Highscore: " + highscore, 15, 75);
    }

    function gameLoop() {
      if (gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.font = "40px Arial";
        ctx.fillText("Game Over!", 150, 300);
        ctx.fillText("Score: " + score, 180, 360);

        if (score > highscore) {
          highscore = score;
          localStorage.setItem("racingHighscore", highscore);
          ctx.fillText("New Highscore!", 130, 420);
        }
        ctx.fillText("Press Enter to Restart", 80, 480);
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawBackground();
      drawLanes();

      speed = 2 + Math.floor(score / 10) * 0.25;

      drawCar();
      updateObstacles();
      updateCoins();
      drawObstacles();
      drawCoins();
      checkCollisions();
      drawScore();

      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", (e) => {
      if (gameOver && e.key === "Enter") {
        resetGame();
        gameLoop();
      }
      if (e.key === "ArrowLeft") {
        let laneIndex = lanes.findIndex(l => Math.abs(player.x + carWidth/2 - l) < 5);
        if (laneIndex > 0) player.x = lanes[laneIndex - 1] - carWidth/2;
      }
      if (e.key === "ArrowRight") {
        let laneIndex = lanes.findIndex(l => Math.abs(player.x + carWidth/2 - l) < 5);
        if (laneIndex < 2) player.x = lanes[laneIndex + 1] - carWidth/2;
      }
    });

    document.getElementById("highscoreText").innerText =
      "Current Highscore: " + highscore;
  </script>
</body>
</html>
